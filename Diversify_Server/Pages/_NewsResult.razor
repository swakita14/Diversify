@using System.Diagnostics
@inject ICompanyNewsService Client


<SfGrid DataSource="@_results.Articles" AllowPaging="true" AllowSorting="true">
    <GridPageSettings PageSize="6"></GridPageSettings>
    <GridColumns>
        <GridColumn Field=@nameof(Article.UrlToImage) HeaderText="" Width="80" TextAlign="TextAlign.Center">
            <Template>
                @{
                    var image = (context as Article);
                    <div class="image">
                        <img src="@image.UrlToImage"/>
                    </div>
                }
            </Template>

        </GridColumn>

        <GridColumn Field=@nameof(Article.Title) HeaderText="Title" Width="120" TextAlign="TextAlign.Center"></GridColumn>
        <GridColumn Field=@nameof(Article.Author) HeaderText="Author" Width="150" TextAlign="TextAlign.Center"></GridColumn>
        <GridColumn Field=@nameof(Article.Description) HeaderText="Description" Width="150" TextAlign="TextAlign.Center"></GridColumn>
        <GridColumn Field=@nameof(Article.PublishedAt) HeaderText="Publish Date" Format="d" Type="ColumnType.Date" Width="120" TextAlign="TextAlign.Center"></GridColumn>
        <GridColumn Field=@nameof(Article.Source) HeaderText="Link" Width="120">
            <Template>
                @{
                    var news = (context as Article);
                    <div><a href="#" @onclick="@(() => Navigate(news))">View</a></div>
                }
            </Template>
        </GridColumn>
    </GridColumns>
</SfGrid>

<style>
    .image img {
        height: 60px;
        width: 70px;
    }
</style>




@code {

    [Parameter]
    public string CompanyName { get; set; }

    private NewsSearchResult _results = new NewsSearchResult();

    protected override async Task OnParametersSetAsync()
    {
        if (!string.IsNullOrEmpty(CompanyName))
        {
            _results = await Client.GetCompanyNewsAsync(CompanyName);
        }

        StateHasChanged();

    }

    public void Navigate(Article source)
    {
        Debug.Write(source.Source);
    }

    public static string TruncateAtWord(string input, int length)
    {
        if (input == null || input.Length < length)
            return input;
        int iNextSpace = input.LastIndexOf(" ", length, StringComparison.Ordinal);
        return string.Format("{0}…", input.Substring(0, (iNextSpace > 0) ? iNextSpace : length).Trim());
    }


}
